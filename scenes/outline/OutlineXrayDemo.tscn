[gd_scene load_steps=14 format=3 uid="uid://outline_xray_demo"]

[ext_resource type="Shader" path="res://shared/shaders/MaskDepthBlit.gdshader" id="1"]
[ext_resource type="Shader" path="res://shared/shaders/OutlineComposite.gdshader" id="2"]
[ext_resource type="Script" path="res://shared/rendering/OutlineSetup.gd" id="3"]

[sub_resource type="QuadMesh" id="1"]
size = Vector2(2, 2)
flip_faces = true

[sub_resource type="QuadMesh" id="2"]
size = Vector2(2, 2)
flip_faces = true

[sub_resource type="ShaderMaterial" id="3"]
shader = ExtResource("1")

[sub_resource type="ShaderMaterial" id="4"]
shader = ExtResource("2")
shader_parameter/thickness_px = 3
shader_parameter/color_front = Color(1, 0.8, 0.3, 1)
shader_parameter/color_occluded = Color(0.0, 0.85, 1.0, 1)

[sub_resource type="StandardMaterial3D" id="5"]
albedo_color = Color(0.36, 0.36, 0.36, 1)

[sub_resource type="StandardMaterial3D" id="6"]
albedo_color = Color(0.27, 0.62, 1.0, 1)

[sub_resource type="StandardMaterial3D" id="7"]
albedo_color = Color(0.18, 0.18, 0.18, 1)

[sub_resource type="BoxMesh" id="8"]
size = Vector3(1.3, 1.3, 1.3)

[sub_resource type="SphereMesh" id="9"]
radial_segments = 32
rings = 16
radius = 0.8

[sub_resource type="PlaneMesh" id="10"]
size = Vector2(1, 1)

[node name="OutlineXrayDemo" type="Node3D"]

[node name="Sun" type="DirectionalLight3D" parent="."]
transform = Transform3D(0.866025, 0, 0.5, 0.25, 0.866025, -0.433012, -0.433013, 0.5, 0.75, 0, 4, 0)
light_color = Color(1, 0.97, 0.9, 1)
light_energy = 2.0
shadow_enabled = false

[node name="MainCamera" type="Camera3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.939693, 0.34202, 0, -0.34202, 0.939693, 0, 2.4, 7)
current = true
fov = 60.0
near = 0.05
far = 80.0

[node name="Ground" type="MeshInstance3D" parent="."]
mesh = SubResource("10")
material_override = SubResource("7")
transform = Transform3D(10, 0, 0, 0, 1, 0, 0, 0, 10, 0, 0, 0)
cast_shadow = 0

[node name="OccluderWall" type="MeshInstance3D" parent="."]
mesh = SubResource("10")
material_override = SubResource("5")
transform = Transform3D(4, 0, 0, 0, 3, 0, 0, 0, 0.15, 0, 1.5, -2.5)
cast_shadow = 0

[node name="OutlinedCube" type="MeshInstance3D" parent="."]
mesh = SubResource("8")
material_override = SubResource("6")
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -1.3, 1.1, -4.5)
layers = 524289

[node name="OutlinedSphere" type="MeshInstance3D" parent="."]
mesh = SubResource("9")
material_override = SubResource("6")
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 1.4, 1.0, -4.8)
layers = 524289

[node name="OutlineMaskVP" type="SubViewport" parent="."]
size = Vector2i(640, 360)
usage = 2
transparent_bg = true
render_target_update_mode = 3

[node name="OutlineMaskCam" type="Camera3D" parent="OutlineMaskVP"]
current = true
near = 0.05
far = 80.0

[node name="DepthBlit" type="MeshInstance3D" parent="OutlineMaskCam"]
mesh = SubResource("1")
material_override = SubResource("3")
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -0.1)
layers = 524288
cast_shadow = 0
render_priority = 1

[node name="OutlineComposite" type="MeshInstance3D" parent="MainCamera"]
mesh = SubResource("2")
material_override = SubResource("4")
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -0.05)
cast_shadow = 0
render_priority = 2

[node name="OutlineSetup" type="Node" parent="."]
script = ExtResource("3")
main_camera = NodePath("../MainCamera")
outline_mask_vp = NodePath("../OutlineMaskVP")
outline_mask_cam = NodePath("../OutlineMaskVP/OutlineMaskCam")
depth_blit_mat = SubResource("3")
outline_mat = SubResource("4")
outline_layer_bit = 19
vp_scale = 0.5

